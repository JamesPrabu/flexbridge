<?xml version="1.0" encoding="UTF-8"?>
<!-- These variables define the Windows Installer product version, product code and upgrade code. They   -->
<!-- will be used later on in this file.  this value should be B U I  LD_SCRIPT_MUST_REPLACE_AT_RUNTIME  (in quotes)-->
<?define Property_ProductVersion = ".*" ?>
<!--this is replaced at build time by the msbuild 'package' target -->
<?define Property_ProductCode = "*" ?>
<!-- auto-generate a new guid each time -->
<?define Property_UpgradeCode = "{3d9bf2dd-4a25-11df-9879-0800200c9a66}" ?>
<!--Don't even think of EVER changing this -->

<!-- good intro to the component vs. file thing, and why each file here is a separate component:
http://blogs.msdn.com/robmen/archive/2003/10/04/56479.aspx -->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">

  <Product Id="$(var.Property_ProductCode)" Name="FieldWorks Bridge" Language="1033"
			 Version="$(var.Property_ProductVersion)" Manufacturer="SIL"
			 UpgradeCode="$(var.Property_UpgradeCode)">

	<Package  Compressed="yes" InstallerVersion="200" />

	<Upgrade Id ="$(var.Property_UpgradeCode)" >
	  <UpgradeVersion Minimum ="$(var.Property_ProductVersion)" OnlyDetect ="yes" Property ="NEWVERSIONDETECTED" />
	  <UpgradeVersion Minimum ="0.0.0" IncludeMinimum ="yes" Maximum ="$(var.Property_ProductVersion)" IncludeMaximum ="no" Property ="OLDERVERSIONBEINGUPGRADED" />
	</Upgrade >

	<Property Id="FW7INSTALLDIR">
	  <RegistrySearch Id="SearchForFW7" Root="HKLM" Key="SOFTWARE\SIL\FieldWorks\7.0" Name="RootCodeDir" Type="raw" />
	</Property>

 <!--<Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" /> WixUi_InstallDir -->
	<UIRef Id="WixUI_Minimal"/>

<!-- # WixUIBannerBmp / Top banner / 493 x 58
# WixUIDialogBmp / Background bitmap used on the welcome and completion dialogs / 493 Ã— 312

	<WixVariable Id='WixUIBannerBmp' Value='..\..\artwork\installerBanner.bmp' />
	<WixVariable Id='WixUIBannerBmp' Value='..\..\artwork\topOfInstaller.jpg' />
	<WixVariable Id='WixUIDialogBmp' Value='..\..\artwork\installerBackground.jpg' />
-->

	<WixVariable Id="WixUILicenseRtf" Value="..\..\distfiles\License.rtf" />

	<!--
	"from the list: Don't use Advertise="yes" Advertised shortcuts are designed to allow
users to install just the shortcut for your app, then demand-install the
rest of the app the first time the icon is run.  If this is not behavior you
are trying to support, you're better off using non-advertised shortcuts. "-->

	<Condition Message="Before Lift Bridge can install, you need to install SIL's FieldWorks 7.">
	  Installed OR FW7INSTALLDIR
	</Condition>
	<PropertyRef Id="NETFRAMEWORK35" />
	<Condition Message="Before Lift Bridge can install, you need to install Microsoft's free .NET Framework 3.5." >
	  Installed OR NETFRAMEWORK35
	</Condition>

	<!--because of bug, this needs to be 1 -->
	<Property Id ="ALLUSERS">1</Property>

	<Directory Id="TARGETDIR" Name="SourceDir">

	  <Directory Id='ProgramMenuFolder' Name='Programs'>
		<Directory Id='FieldWorksBridgeShortcutDir' Name='FieldWorksBridge'>
		  <Component Id ='removeShortcutDir' Guid ="{3d9bf2de-4a25-11df-9879-0800200c9a66}">
			<RemoveFolder Id ="shortcutDirRemover" On ="uninstall"/>
			<RegistryKey Id="keyPathForRemoveShortcutDir" Action ="createAndRemoveOnUninstall" Root="HKCU" Key="SOFTWARE\SIL\FieldWorksBridge\Components\FieldWorksBridgeShortcutDir">
			  <RegistryValue Type ="string" Value =""  Action ="write" KeyPath ="yes"/>
			</RegistryKey>
		  </Component>
		</Directory>
	  </Directory>

	  <Directory Id="ProgramFilesFolder" Name="PFiles">
		<Directory Id="SILDIR" Name="SIL">
		  <Directory Id="INSTALLDIR" Name="FieldWorksBridge">

		  <Component Id="FieldWorksBridge.exe" Guid="{3d9bf2df-4a25-11df-9879-0800200c9a66}">
			<RegistryKey Id="keyFieldWorksBridge.exe" Action ="createAndRemoveOnUninstall" Root="HKCU" Key="SOFTWARE\SIL\FieldWorksBridge\Components\FieldWorksBridge.exe">
			  <RegistryValue Type ="string" Value =""  Action ="write" KeyPath ="yes"/>
			</RegistryKey>
			<File Id="FieldWorksBridge.exe" Name="FieldWorksBridge.exe"  Source="..\..\output\Release\FieldWorksBridge.exe" />
			<Shortcut Id="startmenuShortcut"  Directory="FieldWorksBridgeShortcutDir" Name="FieldWorksBridge"
			  WorkingDirectory="INSTALLDIR" Target="[!FieldWorksBridge.exe]"  Icon ="FieldWorksBridge.exe" />
		  </Component>

		  <Component Id="Autofac.dll" Guid="{3d9bf2e0-4a25-11df-9879-0800200c9a66}">
			<File Id="Autofac.dll" Name="Autofac.dll" KeyPath="yes" Source="..\..\output\Release\Autofac.dll" />
		  </Component>

		  <Component Id="Chorus.exe" Guid="{3d9bf2e3-4a25-11df-9879-0800200c9a66}">
			<File Id="Chorus.exe" Name="Chorus.exe" KeyPath="yes" Source="..\..\output\Release\Chorus.exe" />
		  </Component>

		  <Component Id="ChorusMerge.exe" Guid="{3d9bf2e1-4a25-11df-9879-0800200c9a66}">
			<File Id="ChorusMerge.exe" Name="ChorusMerge.exe" KeyPath="yes" Source="..\..\output\Release\ChorusMerge.exe" />
		  </Component>

		  <Component Id="LibChorus.dll" Guid="{3d9bf2e2-4a25-11df-9879-0800200c9a66}">
			<File Id="LibChorus.dll" Name="LibChorus.dll" KeyPath="yes" Source="..\..\output\Release\LibChorus.dll" />
		  </Component>

		  <Component Id="Palaso.dll" Guid="{3d9bf2e4-4a25-11df-9879-0800200c9a66}">
			<File Id="Palaso.dll" Name="Palaso.dll" KeyPath="yes" Source="..\..\output\Release\Palaso.dll" />
		  </Component>

		  <Component Id="icu.net.dll" Guid="{3d9bf2e5-4a25-11df-9879-0800200c9a66}">
			<File Id="icu.net.dll" Name="icu.net.dll" KeyPath="yes" Source="..\..\output\Release\icu.net.dll" />
		  </Component>

		  <!-- Hopefully, the generated stuff will see that all the Hg gets added here. -->
		  <Directory Id="MercurialDir" Name="Mercurial" />

		</Directory>
		</Directory>
		</Directory>
	</Directory>

	<Feature Id="ProductFeature" Level="1" Title="Basic Stuff">

	  <ComponentRef Id ="FieldWorksBridge.exe"/>
	  <ComponentRef Id ="removeShortcutDir"/>
	  <ComponentRef Id ="Autofac.dll"/>
	  <ComponentRef Id="LibChorus.dll"/>
	  <ComponentRef Id="Chorus.exe"/>
	  <ComponentRef Id="ChorusMerge.exe"/>
	  <ComponentRef Id="Palaso.dll"/>
	  <ComponentRef Id="icu.net.dll"/>

	  <!-- Generated components -->
	  <ComponentGroupRef Id ="DistFiles"/>
	  <ComponentGroupRef Id ="MercurialFiles"/>

	</Feature>

	<Media Id="1" Cabinet="product.cab" EmbedCab="yes" />
	<Icon Id="FieldWorksBridge.exe" SourceFile ="..\..\output\Release\FieldWorksBridge.exe" />
	<!-- what you see in add/remove programs control panel -->
	<Property Id="ARPPRODUCTICON" Value="FieldWorks Bridge" />

	<InstallExecuteSequence>
	  <RemoveExistingProducts After="InstallInitialize" />
	</InstallExecuteSequence>
  </Product>
</Wix>
